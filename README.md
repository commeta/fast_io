# fast_io
PHP extension, fast DB with indexes

Интеграция C-функций в модуль PHP через API Zend. 
Наши функции `delete_key_value_pair`, `write_key_value_pair` и `find_value_by_key`

## Установка

### Шаг 1: Создание каркаса расширения

Для начала, вам нужно создать каркас вашего расширения. Это можно сделать вручную или с помощью инструмента ext_skel в исходниках PHP. Например:
```
phpize
./configure
make
make test
```

Это создаст базовую структуру для вашего расширения.


### Шаг 2: Компиляция и тестирование

Вам нужно скомпилировать расширение и протестировать его. Используйте phpize, ./configure, make и make install для компиляции и установки вашего расширения. 

После установки не забудьте добавить строку `extension=fast_io.so` в ваш `php.ini`, чтобы активировать расширение.

Теперь вы можете вызывать `find_value_by_key`, `write_key_value_pair` и `deleteKeyValuePair` из PHP как обычные функции.


# Fast_IO Extension for PHP 8

Fast_IO - это расширение для PHP 8, предназначенное для эффективной работы с файлами данных, содержащими пары ключ-значение. Оно предоставляет функции для чтения, записи и удаления данных с использованием низкоуровневого посекторного доступа и портируемой блокировки файла, чтобы обеспечить синхронизацию доступа между параллельными экземплярами.

## Функции расширения

### write_key_value_pair

Функция write_key_value_pair предназначена для записи пары ключ-значение в файл данных. Во время записи устанавливается портируемая блокировка на файл, чтобы другие экземпляры ожидали освобождения файла для чтения или записи.

write_key_value_pair("index_key", "index_val");

**Параметры:**

- index_key - ключ, который будет использоваться для идентификации записи.
- index_val - значение, связанное с ключом.

### find_value_by_key

Функция find_value_by_key осуществляет поиск значения по ключу в файле данных. Она выполняет посекторный низкоуровневый поиск и возвращает найденное значение. Во время работы функция не блокирует файл на чтение, позволяя другим экземплярам выполнять параллельный доступ.

**Пример использования:**

$value = find_value_by_key("index_key");


**Параметры:**

- index_key - ключ, по которому осуществляется поиск значения.

### deleteKeyValuePair

Функция delete_key_value_pair удаляет пару ключ-значение из файла данных. Во время удаления устанавливается портируемая блокировка на файл, чтобы другие экземпляры ожидали освобождения файла. Данные копируются построчно во временный файл с последующим переименованием, что позволяет избежать загрузки всего файла в память.

**Пример использования:**

delete_key_value_pair("index_key", "index_val");


**Параметры:**

- index_key - ключ, связанный с удаляемым значением.
- index_val - значение, которое нужно удалить.

## Особенности реализации

- Все функции используют UNIX портируемую блокировку файла на запись и чтение.
- Параллельные экземпляры функций ожидают в очереди освобождения файла.
- Для предотвращения перегрузки памяти функция удаления работает с копированием данных построчно без загрузки всего файла в память.
- Расширение разработано без использования сторонних фреймворков и библиотек, что обеспечивает его высокую производительность и совместимость с PHP 8.
