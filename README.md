# Fast_IO (beta) Extension for PHP 8
PHP extension, fast DB with indexes

Интеграция C-функций в модуль PHP через API Zend. 

Fast_IO - это расширение для PHP 8, предназначенное для эффективной работы с файлами данных, содержащими пары ключ-значение. Оно предоставляет функции для чтения, записи и удаления данных с использованием низкоуровневого посекторного доступа и портируемой блокировки файла, чтобы обеспечить синхронизацию доступа между параллельными экземплярами.

Позволяет хранить и поддерживать файлы баз данных произвольного размера, чтение файлов осуществляется порциями по 4096 байт (1 кэшируемая ядром ОС страница).

## Список функций
- [write_key_value_pair](/docs/write_key_value_pair.md) - запись пары ключ-значение в текстовый файл
- [pop_key_value_pair](/docs/pop_key_value_pair.md) - извлечение и удаление последней строки из файла
- [rebuild_data_file](/docs/rebuild_data_file.md) - перестройка файла данных и соответствующего индексного файла
- [indexed_write_key_value_pair](/docs/indexed_write_key_value_pair.md) - запись пары ключ-значение в текстовый файл данных и соответствующий индексный файл
- [indexed_find_value_by_key](/docs/indexed_find_value_by_key.md) - Поиск значения по ключу в большом текстовом файле с использованием индексного файла
- [hide_key_value_pair](/docs/hide_key_value_pair.md) - скрытие ключей в файлах, хранящих данные в формате ключ-значение
- [find_value_by_key](/docs/find_value_by_key.md) - поиск значения по ключу в файле данных
- [delete_key_value_pair](/docs/delete_key_value_pair.md) - удаляет пару ключ-значение из файла данных
- [get_index_keys](/docs/get_index_keys.md) - извлечение уникальных ключей из текстового файла
- [update_key_value_pair](/docs/update_key_value_pair.md) - обновления значения по заданному ключу

## Особенности реализации

- Все функции используют UNIX портируемую блокировку файла на запись и чтение.
- Параллельные экземпляры функций ожидают в очереди освобождения файла.
- Для предотвращения перегрузки памяти функции производят чтение данных порциями без загрузки всего файла в память.
- Расширение разработано без использования сторонних фреймворков и библиотек, что обеспечивает его высокую производительность и совместимость с PHP 8.
- Функции с префиксом index_ бинарно безопасны, и позволяют хранить неограниченный объем в файле даных.
- Функции без префикса index_ позволяют хранить строки - пары ключ:значение (string, json, serialized) в файле данных. Размер пары не должен превышать 4096 байт.

---

## Установка

### Шаг 1: Создание каркаса расширения
Скопируйте файлы: `config.m4`, `fast_io.c`, `fast_io.h` в текущий каталог проекта.

Для начала, вам нужно создать каркас вашего расширения. Это можно сделать вручную или с помощью инструмента ext_skel в исходниках PHP. Например:
```
phpize
./configure
make
make test
```

Это создаст базовую структуру для вашего расширения.



### Шаг 2: Компиляция и тестирование

Вам нужно скомпилировать расширение и протестировать его. Используйте phpize, ./configure, make и make test для компиляции и установки вашего расширения.

После установки не забудьте добавить строку `extension=fast_io.so` в ваш `php.ini`, чтобы активировать расширение.

Теперь вы можете вызывать новые функции из PHP как обычные функции.

Результат тестирования: Ubuntu 24.04, Ryzen 12 Cores, 16GB RAM, SATA 3 SSD.

```
write_key_value_pair: 0.11487889289856 (0.00001149)
find_value_by_key: 1.1644461154938 (0.00011644)
find_value_by_key repeat: 0.059406042098999 (0.00000594)
delete_key_value_pair: 10.655761003494 (0.00106558)
indexed_write_key_value_pair: 0.21924114227295 (0.00002192)
indexed_find_value_by_key: 0.91544914245605 (0.00009154)
indexed_find_value_by_key repeat: 0.11506295204163 (0.00001151)
pop_key_value_pair: 0.20079398155212 (0.00002008)
```

Функция запускалась в цикле 10000 раз, с линейным инкрементом индекса (без попадания в кэш) и repeat многократный поиск одного и того же индекса.
Показано время в секундах по результатам теста: 10000 запусков (1 запуск).
