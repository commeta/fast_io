# Описание функции file_update_array

Функция file_update_array предназначена для обновления строк в файле, осуществляет множественные запросы основываясь на данных косвенной адресации (смещение, размер).

Эта функция реализована на языке C и доступна в PHP через Fast_IO специальное расширение.


Функция file_update_array перебирает массив адресов переданный в параметрах вызова. Извлекает из массива: строку line, смещение offset и размер size. 
Далее происходит запись указанного блока в файл.


## Синтаксис

int file_update_array(string $filename, array $query[, int $mode = 0])

### Параметры

- **filename** (string): Путь к файлу, из которого необходимо извлечь ключи
- **query** - Массив: [[line, offset, size],]
- **mode** (int, optional) - Режим.


#### Режимы
- 0: c добавлением символа перевода строки к line.
- 1: без добавления символа перевода строки.
- +100 Log mode: Если добавить +100 к любому из вышеперечисленных режимов, функция пересчитает режим mode -= 100 но не будет блокировать файл.

Режимы +100 Log mode подходят для работы с файлами журналов.


## Возвращаемые значения

- Возвращает количество записанных байт.
- Возвращает -1, если не удалось открыть файл.
- Возвращает -2, если не удалось заблокировать файл.
- Возвращает -3, если не удалось установить указатель файла в нужную позицию.
- Возвращает -4, если не удалось записать данные в файл.
- Возвращает -8, если произошла ошибка выделения памяти.


## Особенности работы

При использовании функции чтения файла, будет использоваться внутренний буфер стандартной библиотеки ввода-вывода (stdio). 
Этот внутренний буфер называется "подстрочным буфером" и обычно применяется для оптимизации операций чтения и записи данных.

Когда вы вызываете функцию для чтения данных из файла, стандартная библиотека ввода-вывода может использовать внутренний буфер для кэширования прочитанных данных. 
Это позволяет сократить количество системных вызовов к файловой системе для операций чтения и улучшить производительность приложения.

Подстрочный буфер будет автоматически заполняться, когда данные считываются из файла, и автоматически сбрасываться при достижении определенного размера буфера или при вызове функции fflush. 
Также буфер будет сбрасываться при закрытии файла.

По умолчанию стандартная библиотека ввода-вывода обеспечивает автоматическую буферизацию для повышения производительности ввода-вывода.



## Примеры использования

```
for($i=0; $i <=500; $i++){
	print_r(
		file_insert_line(__DIR__ . '/fast_io1.dat', 'index_' . $i . ' file_insert_line_' . $i . ' ' . str_pad('', 92, '1234567890'), 8192) . ', '
	);
}

$array= [
	['file_update_array 1', 8192, 8192], // Адрес и размер строки 1 в файле
	['file_update_array 2', 16384, 8192], // Адрес и размер строки 2 в файле
	['file_update_array 3', 24576, 8192] // Адрес и размер строки 3 в файле
];

print_r([
	file_update_array(__DIR__ . '/fast_io1.dat', $array, 0),
]);

Array
(
    [0] => 24576
)

```


## Стоимость вызова

- CPU Bound - Только выделение буфера.
- IO Bound - Посекторная запись файла в буфер.

Среднее потребление, при линейной записи если файл не помещается в буфер - низкое, если файл или окно файла в буфере - сверх низкое.

