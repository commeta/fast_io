# Описание функции file_push_line

Функция file_push_line реализована на языке C и предназначена для использования в PHP через Fast_IO специализированное расширение. Эта функция позволяет записывать пары ключ-значение в текстовый файл, обеспечивая при этом блокировку файла для предотвращения одновременной записи из разных процессов. Это гарантирует целостность данных в многопоточных или многопроцессных средах.

## Синтаксис

int file_push_line(string $filename, string $line)


### Параметры

- **filename** - Путь к текстовому файлу, в который будет произведена запись.
- **line** - Строка которая будет записана в файл.

### Возвращаемые значения

- Возвращает смещение начала строки в файле, если запись прошла успешно.
- Возвращает -1, если не удалось открыть файл.
- Возвращает -2, если не удалось установить блокировку на файл.
- Возвращает -3, если не удалось выполнить запись в файл.


## Пример использования

```
<?php
$filename = 'path/to/data.txt';
$line = 'example_key_value';

$result = file_push_line($filename, $line);

if ($result >= 0) {
    echo "Запись успешно выполнена";
} elseif ($result == -1) {
    echo "Ошибка: не удалось открыть файл";
} elseif ($result == -2) {
    echo "Ошибка: не удалось установить блокировку на файл";
}
?>
```

Еще [пример](/test/readme.md): Тесты.

### Формат файла

Файл будет содержать данные в формате ключ-значение, разделённые пробелом, каждая пара на новой строке. Например:

```
index_0 data_write_key_value_pair_0
index_1 data_write_key_value_pair_1
index_2 data_write_key_value_pair_2
```


## Ограничения

- Файл должен быть доступен для записи.
- Блокировка файла обеспечивает целостность данных только в рамках одного сервера. В распределённых системах может потребоваться дополнительная синхронизация.

## Стоимость вызова

- CPU Bound - Нет.
- IO Bound - Запись строки в конец файла.

Очень низкое потребление, запись строки в конец файла.


## Заключение

Функция file_push_line представляет собой надёжный инструмент для записи строк в текстовые файлы с учётом синхронизации доступа. Это особенно важно в многопоточных и многопроцессных приложениях, где одновременная запись может привести к потере данных. Убедитесь, что ваше PHP-окружение поддерживает необходимое расширение для использования этой функции.
