# Описание функции delete_key_value_pair

Функция delete_key_value_pair написана на языке C и предназначена для использования в PHP через специализированное расширение Fast_IO. 

Функция delete_key_value_pair удаляет пару ключ-значение из файла данных. 
Во время удаления устанавливается портируемая блокировка на файл, чтобы другие экземпляры ожидали освобождения файла. 
Данные копируются порциями во временный файл с последующим переименованием, что позволяет избежать загрузки всего файла в память.


## Синтаксис

long delete_key_value_pair(string $filename, string $index_key)


### Параметры

- **$filename** *(string)*: Путь к файлу, из которого будут удалены пары ключ-значение.
- **$index_key** *(string)*: Ключ, по которому будут идентифицированы и удалены пары ключ-значение. Если не указан, функция удалит все записи, не начинающиеся с специального символа (ASCII Code 127).

### Возвращаемые значения

- Возвращает TRUE в случае успешного удаления.
- Возвращает FALSE, если произошла ошибка при разборе параметров.
- Возвращает длинное целое число (long), представляющее код ошибки, в случае возникновения ошибок при выполнении операций с файлом.

## Ошибки

Функция может возвращать следующие коды ошибок:

- -1: Не удалось открыть исходный файл.
- -2: Не удалось создать временный файл.
- -3: Не удалось заблокировать файл.
- -4: Не удалось ассоциировать поток с дескриптором файла.
- -5: Не удалось заменить исходный файл временным файлом.

## Пример использования

Для использования этой функции необходимо, чтобы ваше PHP-окружение поддерживало соответствующее расширение.
```
<?php
$filename = "/path/to/your/file.txt";
$index_key = "yourKey";

$result = delete_key_value_pair($filename, $index_key);

if ($result === TRUE) {
    echo "Ключ успешно удален.\n";
} elseif ($result === FALSE) {
    echo "Произошла ошибка при разборе параметров.\n";
} else {
    echo "Произошла ошибка: код {$result}.\n";
}
?>
```

Еще [пример](/test/test.php): стресс тест.


### Особенности работы

Функция работает с текстовыми файлами, где каждая строка представляет собой пару ключ-значение, разделенные пробелом. При удалении функция создает временный файл, в который копируются все строки, не соответствующие указанному ключу. После завершения чтения и копирования, временный файл заменяет оригинальный, тем самым удаляя указанную пару ключ-значение.

### Ограничения

- Файл должен быть доступен для чтения и записи.
- Для корректной работы функции необходимо, чтобы размер буфера был достаточным для чтения строк файла.
- Функция предполагает, что пары ключ-значение разделены простым пробелом и что ключи уникальны в рамках файла.


## Примечания

- Функция работает путем создания временного файла, в который копируются все строки из исходного файла, не соответствующие заданному ключу. После завершения операции исходный файл заменяется временным.
- Важно обеспечить достаточные права доступа к файлам и директориям для корректной работы функции.
- Рекомендуется делать резервную копию файла перед использованием этой функции для предотвращения потери данных.

## Бюджет ресурсов

- CPU Bound - Заполнение буфера и полнотекстовый поиск в начале каждой строки.
- IO Bound - Посекторное чтение файла в буфер, запись строк во временный файл.

Высокое потребление, чтение\запись всего файла.

## Заключение

Функция delete_key_value_pair предоставляет эффективный способ удаления данных из текстовых файлов в PHP приложениях. Благодаря использованию временного файла и порционного чтения, функция обеспечивает высокую производительность и минимизацию использования памяти даже для больших файлов данных.
