# Описание функции write_key_value_pair

Функция write_key_value_pair реализована на языке C и предназначена для использования в PHP через Fast_IO специализированное расширение. Эта функция позволяет записывать пары ключ-значение в текстовый файл, обеспечивая при этом блокировку файла для предотвращения одновременной записи из разных процессов. Это гарантирует целостность данных в многопоточных или многопроцессных средах.

## Синтаксис

int write_key_value_pair(string $filename, string $index_key_val)


### Параметры

- **filename** - Путь к текстовому файлу, в который будет произведена запись.
- **index_key_val** - Строка которая будет записана в файл.

### Возвращаемые значения

- Возвращает смещение начала строки в файле, если запись прошла успешно.
- Возвращает -1, если не удалось открыть файл.
- Возвращает -2, если не удалось установить блокировку на файл.

## Пример использования

```
<?php
$filename = 'path/to/data.txt';
$key_value = 'example_key_value';

$result = write_key_value_pair($filename, $key_value);

if ($result == 1) {
    echo "Запись успешно выполнена";
} elseif ($result == -1) {
    echo "Ошибка: не удалось открыть файл";
} elseif ($result == -2) {
    echo "Ошибка: не удалось установить блокировку на файл";
}
?>
```

Еще [пример](/test/test.php): стресс тест.

### Формат файла

Файл будет содержать данные в формате ключ-значение, разделённые пробелом, каждая пара на новой строке. Например:

```
index_0 data_write_key_value_pair_0
index_1 data_write_key_value_pair_1
index_2 data_write_key_value_pair_2
```


## Ограничения

- Файл должен быть доступен для записи.
- Блокировка файла обеспечивает целостность данных только в рамках одного сервера. В распределённых системах может потребоваться дополнительная синхронизация.

## Стоимость вызова

- CPU Bound - Нет.
- IO Bound - Запись строки в конец файла.

Очень низкое потребление, запись строки в конец файла.


## Заключение

Функция write_key_value_pair представляет собой надёжный инструмент для записи строк в текстовые файлы с учётом синхронизации доступа. Это особенно важно в многопоточных и многопроцессных приложениях, где одновременная запись может привести к потере данных. Убедитесь, что ваше PHP-окружение поддерживает необходимое расширение для использования этой функции.
