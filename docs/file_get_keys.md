# Описание функции file_get_keys

Функция file_get_keys предназначена для извлечения ключей или данных о косвенной адресации текстового файла, где каждая строка содержит пары ключ-значение, разделенные пробелом.

Эта функция реализована на языке C и доступна в PHP через Fast_IO специальное расширение.

Функция file_get_keys проходит по всему файлу, читая его содержимое и извлекая ключи из каждой строки. Ключи собираются в массив. Результатом работы функции является массив ключей.


## Синтаксис

array file_get_keys(string $filename[, int search_start = 0][, int search_length = 1][, int offset = 0][, int mode = 0])

### Параметры

- **filename** (string): Путь к файлу, из которого необходимо извлечь ключи.
- **search_start** (int, optional) - Стартовая строка начала выборки.
- **search_limit** (int, optional) - Ограничение массива выборки.
- **offset** (int, optional) - Смещение offset начала поиска в файле.
- **mode** (int, optional) - Режим поиска.


#### Режимы поиска
- 0: Блокировка файла.
- 100 Log mode: Без блокировки файла.

### Возвращаемое значение

Функция возвращает ассоциативный массив
- key - Ключ строки
- offset - Смещение строки (с учетом смещения начала поиска в файле)
- length - Длина строки
- count - Счетчик строк от начала поиска


Чтение по смещению offset позволяет избежать лишних чтений файла при выборке с окном пагинации.
Может потребоваться для пагинации таблицы ключей или пагинации таблицы распределения косвенной адресации строк в файле.

Чтение файла идет всегда с нулевой позиции offset = 0, и если search_start больше нуля то функция просто пропускает строки у которых номер меньше search_start.


### Примеры возвращаемых массивов

```
for($i=0; $i <=500; $i++){
	print_r(
		file_insert_line(__DIR__ . '/fast_io1.dat', 'index_' . $i . ' insert_line_' . $i . ' ' . str_pad('', 8, '1234567890'), 8192)
	);
}

print_r([
	file_get_keys(__DIR__ . '/fast_io1.dat', 1, 5)
]);

0, 1, 2, 3, 4, Array
(
    [0] => Array
        (
            [0] => Array
                (
                    [key] => index_1
                    [offset] => 8192
                    [length] => 8192
                    [count] => 2
                )

            [1] => Array
                (
                    [key] => index_2
                    [offset] => 16384
                    [length] => 8192
                    [count] => 3
                )

            [2] => Array
                (
                    [key] => index_3
                    [offset] => 24576
                    [length] => 8192
                    [count] => 4
                )

            [3] => Array
                (
                    [key] => index_4
                    [offset] => 32768
                    [length] => 8192
                    [count] => 5
                )

            [4] => Array
                (
                    [key] => index_5
                    [offset] => 40960
                    [length] => 8192
                    [count] => 6
                )

        )

)

```



Еще [пример](/test/readme.md): Тесты.

## Замечания

- Файл должен быть доступен для чтения процессом, выполняющим PHP-скрипт.
- В случае ошибки при открытии файла или его блокировке, функция вернет пустой массив.
- Функция не чувствительна к регистру ключей и возвращает их в том виде, в каком они представлены в файле.


## Стоимость вызова

- CPU Bound - Заполнение буфера и полнотекстовый поиск в начале каждой строки.
- IO Bound - Посекторное чтение файла в буфер.

Среднее потребление, чтение всего файла.
