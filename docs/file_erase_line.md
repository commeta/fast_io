# Описание функции file_erase_line

Функция file_erase_line написана на языке C и представляет собой часть Fast_IO расширения PHP. Она предназначена для скрытия (замены на спецсимвол) ключей в файлах, хранящих данные в формате ключ-значение. Эта функция может быть полезна для обеспечения конфиденциальности ключей в файлах на сервере, не удаляя при этом соответствующие значения.


Страница описания прокта [Fast_IO Engine](https://github.com/commeta/fast_io).


## Синтаксис

int file_erase_line(string $filename, string $line_key[, int $position = 0][, int $mode = 0])

### Параметры

- **filename** - Путь к файлу, в котором требуется скрыть ключ.
- **line_key** - Ключ, который необходимо скрыть в файле.
- **position** (int, optional) - Позиция начала поиска в файле.
- **$mode** (int, optional): Режим.

##### Log mode
- +100 Log mode: Если добавить +100 к любому из вышеперечисленных режимов, функция пересчитает режим $mode - 100 но не будет блокировать файл.


### Возвращаемые значения

- Возвращает смещение (offset в файле) строки обновленных данных.
- Возвращает -1, если файл не удалось открыть.
- Возвращает -2, если не удалось захватить блокировку файла.
- Возвращает -3, если произошла ошибка записи в файл.
- Возвращает -4, если указанный ключ не найден.
- Возвращает -8, если произошла ошибка выделения памяти.

## Пример использования

Для использования функции file_erase_line в вашем PHP-приложении, следуйте примеру ниже:
```
<?php
for($i=0; $i <=500; $i++){
	print_r(
		file_insert_line(__DIR__ . '/fast_io1.dat', 'index_' . $i . ' file_insert_line_' . $i . ' ' . str_pad('', 92, '1234567890'), 0, 8192) . ', '
	);
}

print_r([
	file_search_line(__DIR__ . '/fast_io1.dat', 'index_123'),
	file_erase_line(__DIR__ . '/fast_io1.dat', 'index_123'),
	file_search_line(__DIR__ . '/fast_io1.dat', 'index_123'),
]);

Array
(
    [0] => index_123 file_insert_line_123 12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012
    [1] => 1007616
    [2] => 
)

```

Еще [пример](/test/readme.md): Тесты.

### Особенности работы

Функция работает следующим образом:

1. Открывает указанный файл в режиме чтения и записи.
2. Блокирует файл для исключительного доступа.
3. Читает файл и ищет строки, начинающиеся с указанного ключа.
4. Заменяет всю строку на последовательность символов (ASCII Code 127).
5. Записывает обновленные данные обратно в файл.
6. Разблокирует и закрывает файл.

### Ограничения

- Функция требует, чтобы файл был доступен для чтения и записи.
- Функция блокирует файл на время своей работы, что может привести к задержкам при одновременном доступе из других процессов.

## Стоимость вызова

- CPU Bound - Заполнение буфера и полнотекстовый поиск в начале каждой строки.
- IO Bound - Посекторное чтение файла в буфер, запись строки в файл.

Среднее потребление, чтение всего файла, запись строки в файл.


## Примечание 

Фрагментация в файле данных возникает после операции скрытия строк: file_erase_line, file_update_line или file_replace_line с установкой спецсимвола (ASCII Code 127).

## Заключение

Функция file_erase_line предлагает эффективный способ скрытия ключей в файлах данных без удаления соответствующих значений. Это может быть особенно полезно для защиты конфиденциальных данных или для временного скрытия информации без потери данных. Использование этой функции помогает улучшить безопасность данных в PHP-приложениях.
