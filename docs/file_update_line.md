# Описание функции file_update_line

Функция file_update_line предназначена для обновления строки (по номеру или смещению) в текстовом файле. Эта функция является частью PHP расширения Fast_IO, написанного на C, 
и предоставляет возможность эффективно обновлять строки в больших файлах без необходимости загружать весь файл в память.


Страница описания прокта [Fast_IO Engine](https://github.com/commeta/fast_io).


## Синтаксис

int file_update_line(string $filename, string $line, int $position, int $line_length [, int mode = 0])


## Параметры

- filename - строка, путь к файлу, в котором будет производиться обновление.
- line - строка, которая будет записана в файл.
- position - целое число, смещение в файле.
- line_length - целое число, размер одной записи в файле (включая перенос строки).
- mode (int, optional) - Режим адресации.


#### Режимы
- 0: Режим с добавлением символа перевода строки.
- 1: Режим без добавления символа перевода строки.

##### Log mode
- +100 Log mode: Если добавить +100 к любому из вышеперечисленных режимов, функция пересчитает режим mode - 100 но не будет блокировать файл.

Режимы +100 Log mode подходят для работы с файлами журналов. Подробнее: [алгоритм реализации транзакции с помощью блокировки файла](/test/transaction/README.md).


## Возвращаемые значения

- Возвращает количество записанных байт.
- Возвращает -1, если не удалось открыть файл.
- Возвращает -2, если не удалось заблокировать файл.
- Возвращает -3, если не удалось установить указатель файла в нужную позицию.
- Возвращает -4, если не удалось записать данные в файл.
- Возвращает -8, если произошла ошибка выделения памяти.

## Особенности работы

При подготовке строки line к записи в файл, создается временный буфер размером line_length байт, заполненный пробелами. 
Если строка len меньше или равна line_length, то строка копируется в начало буфера. Если строка len больше line_length, то строка копируется в буфер насколько поместится.
В режимах mode = 1 в конце буфера устанавливается символ перевода строки.


## Пример использования

В следующем примере показано, как использовать функцию update_key_value для обновления строки в файле:
```
<?php

$result = file_update_line("path/to/your/file.txt", "newValue", 3, 20);

if ($result < 0) {
    echo "Ошибка при обновлении записи: код ошибки $result.";
} else {
    echo "Запись успешно обновлена.";
}

?>
```
В этом примере функция file_update_line используется для обновления значения в третьей строке файла file.txt. Размер каждой записи установлен в 20 байт.


Еще [пример](/test/readme.md): Тесты.

## Примечания

- Функция блокирует файл на время операции, предотвращая одновременный доступ других процессов.
- Перед использованием убедитесь, что файл существует и имеет правильный формат записей.

## Стоимость вызова

- CPU Bound - Подготовка строки к записи с учетом выравнивания и перевода строки
- IO Bound - Посекторная запись в файл по указанному смещению и размеру.

Очень низкое потребление, посекторная запись отрезка файла.

---

Обратите внимание, что для работы с этой функцией требуется предварительно скомпилированное и установленное PHP расширение Fast_IO, содержащее определение функции file_update_line.
