# Описание функции file_search_line

Функция file_search_line осуществляет поиск значения по ключу в файле данных. 
Она выполняет посекторный низкоуровневый поиск и возвращает найденное значение. 
Во время работы функция не блокирует файл на чтение, позволяя другим экземплярам выполнять параллельный доступ.
Файл читается порциями, что делает функцию эффективной для работы с большими файлами. 

Функция написана на C и доступна в PHP через специализированное расширение Fast_IO.

## Синтаксис

string file_search_line(string $filename, string $line_key[, int mode = 0] )


### Параметры

- **filename** - Путь к файлу, в котором будет производиться поиск.
- **line_key** - Ключ, по которому осуществляется поиск значения.
- **mode** (int, optional) - Режим поиска.


#### Режимы поиска
- 0: Поиск line_key в каждой строке, без учёта разделителей, возвращает первую найденную строку целиком.
- 10: Поиск по регулярному выражению [PCRE2](https://pcre2project.github.io/pcre2/doc/html/index.html) в каждой строке, без учёта разделителей, возвращает первую найденную строку целиком.

### Возвращаемые значения

Функция возвращает строку, содержащую значение, ассоциированное с указанным ключом, если ключ найден. В случае, если ключ не найден или произошла ошибка (например, файл не может быть прочитан), функция возвращает NULL.

Строка возвращается без конечных пробелов и символа перевода строки.

## Пример использования

В этом примере мы ищем значение по ключу "user_id" в файле "data.txt".
```
<?php
$filename = 'path/to/data.txt';
$key = 'user_id';

$value = file_search_line($filename, $key);

if ($value !== NULL) {
    echo "Найденное значение: $value";
} else {
    echo "Значение не найдено или произошла ошибка";
}
?>
```

Еще [пример](/test/readme.md): Тесты.

### Формат файла

Функция предполагает, что файл содержит данные в формате "ключ значение", где каждая пара разделена новой строкой. Например:

```
index_0 data_write_key_value_pair_0
index_1 data_write_key_value_pair_1
index_2 data_write_key_value_pair_2
```


## Ограничения

- Файл должен быть доступен для чтения процессом PHP.
- Ключ и значение в файле должны быть разделены одним пробелом.
- Функция читает файл порциями, размер которых определяется константой BUFFER_SIZE. Это означает, что длинные строки могут быть обрезаны. Убедитесь, что размер буфера достаточен для чтения самой длинной строки в вашем файле.


## Стоимость вызова

- CPU Bound - Заполнение буфера и полнотекстовый поиск в начале каждой строки, регулярные выражения PCRE2.
- IO Bound - Посекторное чтение файла в буфер.

Среднее потребление, чтение всего файла.

## Заключение

Функция file_search_line представляет собой мощный инструмент для чтения и поиска данных в больших файлах, минимизируя потребление памяти. Так как функция написана на C и требует специального расширения для PHP, убедитесь, что ваше окружение настроено соответствующим образом перед использованием функции.
