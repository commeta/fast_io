# Авто тест базы данных


Файл скрипта auto_test.php

Страница описания прокта [Fast_IO Engine](https://github.com/commeta/fast_io).


### Процедура тестирования

Тест для функции file_insert_line начинается с создания файла базы данных fast_io.dat. Затем генерируется случайный размер выравнивания и устанавливается размер буфера. После этого выполняется цикл, в котором в файл базы данных вставляются строки с использованием функции file_insert_line. Каждая вставленная строка проверяется на соответствие ожидаемым параметрам, включая размер и содержание. Также проверяется, что позиции вставленных строк корректны.

Плюсы этого теста включают:
- Использование случайных значений для имитации различных сценариев использования в допустимых диапазонах.
- Проверка различных аспектов работы функций, включая размер строк, содержание и позицию в файле.
- Проверка сходимости базы данных, убеждаясь, что вставленные строки находятся в правильном месте и имеют правильные размеры.
- Тест выводит на экран все ошибки и предупреждения, которые могут возникнуть при работе с базой данных.
- Тест выявляет нестабильное поведение, если генерация случайных значений приведет к ошибкам в работе расширения.

Минусы этого теста включают:
- Тест может быть медленным из-за большого количества операций: вызов функций в цикле, чтение и запись.


#### Тестирование функций
- file_insert_line - Тест сходимости с участием: file_get_keys, file_analize, +рандомный размер буфера.
- file_analize - Тест сходимости 1 режима, с участием: file_insert_line, +рандомный размер буфера.
- file_get_keys - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_search_array - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_select_array - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_search_line - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_select_line - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_pop_line - Тест сходимости транзакционных режимов, с участием: file_insert_line, bugfix! автомат спотыкается на низком буфере.
- file_pop_line - Тест сходимости транзакционных режимов без авто-поиска строки!, с участием: file_insert_line, +рандомный размер буфера.


#### Результат выполнения
Результат тестирования: Ubuntu 24.04, Ryzen 12 Cores, 16GB RAM, SATA 3 SSD.
```
Check file_insert_line: time: 2.3290240764618 - PASS
rchar: 704334945
wchar: 186179882
syscr: 77586
syscw: 11109
read_bytes: 0
write_bytes: 186392576
cancelled_write_bytes: 180805632

Check file_analize: time: 4.960755109787 - PASS
rchar: 6955427225
wchar: 192967073
syscr: 669042
syscw: 11545
read_bytes: 0
write_bytes: 193171456
cancelled_write_bytes: 186724352

Check file_get_keys: time: 2.355838060379 - PASS
rchar: 1111693944
wchar: 185078977
syscr: 104667
syscw: 11180
read_bytes: 0
write_bytes: 185282560
cancelled_write_bytes: 184492032

Check file_search_array: time: 2.8286280632019 - PASS
rchar: 1874622132
wchar: 156011129
syscr: 148959
syscw: 10190
read_bytes: 0
write_bytes: 156209152
cancelled_write_bytes: 155447296

Check file_select_array: time: 3.027752161026 - PASS
rchar: 2565236234
wchar: 170823508
syscr: 153708
syscw: 10532
read_bytes: 0
write_bytes: 171044864
cancelled_write_bytes: 169029632

Check file_search_line: time: 5.437136888504 - PASS
rchar: 12019314844
wchar: 158808803
syscr: 1088615
syscw: 10416
read_bytes: 0
write_bytes: 159031296
cancelled_write_bytes: 154423296

Check file_select_line: time: 1.9463849067688 - PASS
rchar: 765548989
wchar: 181519891
syscr: 81009
syscw: 10493
read_bytes: 0
write_bytes: 181710848
cancelled_write_bytes: 179101696

Check file_pop_line: time: 2.9483249187469 - PASS
rchar: 1152357135
wchar: 348247041
syscr: 87569
syscw: 22084
read_bytes: 0
write_bytes: 348643328
cancelled_write_bytes: 350273536

Check file_pop_line: time: 2.1540770530701 - PASS
rchar: 450267687
wchar: 201619408
syscr: 45437
syscw: 11427
read_bytes: 0
write_bytes: 201822208
cancelled_write_bytes: 201822208

```


##### Статистика ядра Linux Kernel

Источник данных: /proc/pid/io — файл, который содержит информацию о вводе-выводе процесса. Он используется для мониторинга использования дискового ввода-вывода процессом.

- time - время выполнения теста, в секундах.

- rchar (read chars) — количество прочитанных символов процессом. Этот параметр показывает, сколько байт было прочитано процессом с момента запуска теста.

- wchar (written chars) — количество записанных символов процессом. Этот параметр показывает, сколько байт было записано процессом с момента запуска теста.

- syscr (system calls read) — количество системных вызовов чтения, сделанных процессом. Этот параметр показывает, сколько раз процесс обращался к операционной системе с запросом на чтение данных.

- syscw (system calls write) — количество системных вызовов записи, сделанных процессом. Этот параметр показывает, сколько раз процесс обращался к операционной системе с запросом на запись данных.

- read_bytes — общее количество байт, прочитанных процессом с диска. Этот параметр показывает, сколько байт было прочитано процессом с диска с момента запуска теста.

- write_bytes — общее количество байт, записанных процессом на диск. Этот параметр показывает, сколько байт было записано процессом на диск с момента запуска теста.

- cancelled_write_bytes — количество байт, которые были отменены процессом при записи на диск. Этот параметр показывает, сколько байт было отменено процессом при попытке записи на диск.


