# Авто тест базы данных


Файл скрипта auto_test.php

Страница описания прокта [Fast_IO Engine](https://github.com/commeta/fast_io).


### Процедура тестирования

Тест для функции file_insert_line начинается с создания файла базы данных fast_io.dat. Затем генерируется случайный размер выравнивания и устанавливается размер буфера. После этого выполняется цикл, в котором в файл базы данных вставляются строки с использованием функции file_insert_line. Каждая вставленная строка проверяется на соответствие ожидаемым параметрам, включая размер и содержание. Также проверяется, что позиции вставленных строк корректны.

Плюсы этого теста включают:
- Использование случайных значений для имитации различных сценариев использования в допустимых диапазонах.
- Проверка различных аспектов работы функций, включая размер строк, содержание и позицию в файле.
- Проверка сходимости базы данных, убеждаясь, что вставленные строки находятся в правильном месте и имеют правильные размеры.
- Тест выводит на экран все ошибки и предупреждения, которые могут возникнуть при работе с базой данных.
- Тест выявляет нестабильное поведение, если генерация случайных значений приведет к ошибкам в работе расширения.

Минусы этого теста включают:
- Тест может быть медленным из-за большого количества операций: вызов функций в цикле, чтение и запись.


#### Тестирование функций
- file_insert_line - Тест сходимости с участием: file_get_keys, file_analize, +рандомный размер буфера.
- file_analize - Тест сходимости 1 режима, с участием: file_insert_line, +рандомный размер буфера.
- file_get_keys - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_search_array - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_select_array - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_search_line - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_select_line - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_pop_line - Тест сходимости транзакционных режимов с авто-поиском строк, с участием: file_insert_line, +рандомный размер буфера.


#### Результат выполнения
Результат тестирования: Ubuntu 24.04, Ryzen 12 Cores, 16GB RAM, SATA 3 SSD.
```
Check file_insert_line: time: 2.186115026474 - PASS
rchar: 680777013 (311.41 M/s)
wchar: 173243992 (79.25 M/s)
syscr: 76766 (0.04 M/s)
syscw: 10984 (0.01 M/s)
read_bytes: 0 (0.00 M/s)
write_bytes: 173473792 (79.35 M/s)
cancelled_write_bytes: 164847616 (75.41 M/s)

Check file_analize: time: 3.7850120067596 - PASS
rchar: 5917868742 (1,563.50 M/s)
wchar: 178188352 (47.08 M/s)
syscr: 616798 (0.16 M/s)
syscw: 10713 (0.00 M/s)
read_bytes: 0 (0.00 M/s)
write_bytes: 178397184 (47.13 M/s)
cancelled_write_bytes: 182571008 (48.24 M/s)

Check file_get_keys: time: 2.2372951507568 - PASS
rchar: 1137253404 (508.32 M/s)
wchar: 189364181 (84.64 M/s)
syscr: 109083 (0.05 M/s)
syscw: 11038 (0.00 M/s)
read_bytes: 0 (0.00 M/s)
write_bytes: 189595648 (84.74 M/s)
cancelled_write_bytes: 189669376 (84.78 M/s)

Check file_search_array: time: 2.7417509555817 - PASS
rchar: 2201533068 (802.97 M/s)
wchar: 183261858 (66.84 M/s)
syscr: 171433 (0.06 M/s)
syscw: 10989 (0.00 M/s)
read_bytes: 0 (0.00 M/s)
write_bytes: 183468032 (66.92 M/s)
cancelled_write_bytes: 181243904 (66.11 M/s)

Check file_select_array: time: 2.9431412220001 - PASS
rchar: 2833958532 (962.90 M/s)
wchar: 188728407 (64.12 M/s)
syscr: 163758 (0.06 M/s)
syscw: 11331 (0.00 M/s)
read_bytes: 0 (0.00 M/s)
write_bytes: 188936192 (64.20 M/s)
cancelled_write_bytes: 182697984 (62.08 M/s)

Check file_search_line: time: 5.0648438930511 - PASS
rchar: 11827773408 (2,335.27 M/s)
wchar: 167657528 (33.10 M/s)
syscr: 1105195 (0.22 M/s)
syscw: 9878 (0.00 M/s)
read_bytes: 0 (0.00 M/s)
write_bytes: 167845888 (33.14 M/s)
cancelled_write_bytes: 170512384 (33.67 M/s)

Check file_select_line: time: 1.6394920349121 - PASS
rchar: 707533727 (431.56 M/s)
wchar: 167401840 (102.11 M/s)
syscr: 77769 (0.05 M/s)
syscw: 10084 (0.01 M/s)
read_bytes: 0 (0.00 M/s)
write_bytes: 167628800 (102.24 M/s)
cancelled_write_bytes: 161308672 (98.39 M/s)

Check file_pop_line: time: 2.4415328502655 - PASS
rchar: 714881709 (292.80 M/s)
wchar: 437225139 (179.08 M/s)
syscr: 87086 (0.04 M/s)
syscw: 25432 (0.01 M/s)
read_bytes: 0 (0.00 M/s)
write_bytes: 441176064 (180.70 M/s)
cancelled_write_bytes: 441184256 (180.70 M/s)

Check file_callback_line: time: 1.6702420711517 - PASS
rchar: 209627849 (125.51 M/s)
wchar: 187280611 (112.13 M/s)
syscr: 21711 (0.01 M/s)
syscw: 10982 (0.01 M/s)
read_bytes: 0 (0.00 M/s)
write_bytes: 187461632 (112.24 M/s)
cancelled_write_bytes: 187518976 (112.27 M/s)
```


##### Статистика ядра Linux Kernel

Источник данных: /proc/pid/io — файл, который содержит информацию о вводе-выводе процесса. Он используется для мониторинга использования дискового ввода-вывода процессом.

- time - время выполнения теста, в секундах.

- rchar (read chars) — количество прочитанных символов процессом. Этот параметр показывает, сколько байт было прочитано процессом с момента запуска теста.

- wchar (written chars) — количество записанных символов процессом. Этот параметр показывает, сколько байт было записано процессом с момента запуска теста.

- syscr (system calls read) — количество системных вызовов чтения, сделанных процессом. Этот параметр показывает, сколько раз процесс обращался к операционной системе с запросом на чтение данных.

- syscw (system calls write) — количество системных вызовов записи, сделанных процессом. Этот параметр показывает, сколько раз процесс обращался к операционной системе с запросом на запись данных.

- read_bytes — общее количество байт, прочитанных процессом с диска. Этот параметр показывает, сколько байт было прочитано процессом с диска с момента запуска теста.

- write_bytes — общее количество байт, записанных процессом на диск. Этот параметр показывает, сколько байт было записано процессом на диск с момента запуска теста.

- cancelled_write_bytes — количество байт, которые были отменены процессом при записи на диск. Этот параметр показывает, сколько байт было отменено процессом при попытке записи на диск.


