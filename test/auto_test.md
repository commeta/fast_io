# Авто тест базы данных


Файл скрипта auto_test.php

Страница описания прокта [Fast_IO Engine](https://github.com/commeta/fast_io).


### Процедура тестирования

Тест для функции file_insert_line начинается с создания файла базы данных fast_io.dat. Затем генерируется случайный размер выравнивания и устанавливается размер буфера. После этого выполняется цикл, в котором в файл базы данных вставляются строки с использованием функции file_insert_line. Каждая вставленная строка проверяется на соответствие ожидаемым параметрам, включая размер и содержание. Также проверяется, что позиции вставленных строк корректны.

Плюсы этого теста включают:
- Использование случайных значений для имитации различных сценариев использования в допустимых диапазонах.
- Проверка различных аспектов работы функций, включая размер строк, содержание и позицию в файле.
- Проверка сходимости базы данных, убеждаясь, что вставленные строки находятся в правильном месте и имеют правильные размеры.
- Тест выводит на экран все ошибки и предупреждения, которые могут возникнуть при работе с базой данных.
- Тест выявляет нестабильное поведение, если генерация случайных значений приведет к ошибкам в работе расширения.

Минусы этого теста включают:
- Тест может быть медленным из-за большого количества операций: вызов функций в цикле, чтение и запись.


#### Тестирование функций
- file_insert_line - Тест сходимости с участием: file_get_keys, file_analize, +рандомный размер буфера.
- file_analize - Тест сходимости 1 режима, с участием: file_insert_line, +рандомный размер буфера.
- file_get_keys - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_search_array - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_select_array - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_search_line - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_select_line - Тест сходимости транзакционных режимов, с участием: file_insert_line, +рандомный размер буфера.
- file_pop_line - Тест сходимости транзакционных режимов с авто-поиском строк, с участием: file_insert_line, +рандомный размер буфера.


#### Результат выполнения
Результат тестирования: Ubuntu 24.04, Ryzen 12 Cores, 16GB RAM, SATA 3 SSD.
```
Check file_insert_line: time: 2.4393680095673 - PASS
rchar: 721840850 (2,367,304,472.86 MB/s)
wchar: 190374266 (624,339,633.06 MB/s)
syscr: 84525 (277,202.95 MB/s)
syscw: 10755 (35,271.43 MB/s)
read_bytes: 0 (0.00 MB/s)
write_bytes: 190595072 (625,063,774.72 MB/s)
cancelled_write_bytes: 183947264 (603,262,036.00 MB/s)

Check file_analize: time: 4.3009340763092 - PASS
rchar: 6013737818 (11,185,919,544.55 MB/s)
wchar: 179922634 (334,667,085.44 MB/s)
syscr: 577291 (1,073,796.51 MB/s)
syscw: 10521 (19,569.70 MB/s)
read_bytes: 0 (0.00 MB/s)
write_bytes: 180121600 (335,037,174.35 MB/s)
cancelled_write_bytes: 178229248 (331,517,284.08 MB/s)

Check file_get_keys: time: 2.4806950092316 - PASS
rchar: 1205542122 (3,887,756,028.09 MB/s)
wchar: 200729870 (647,334,297.05 MB/s)
syscr: 118137 (380,980.33 MB/s)
syscw: 11213 (36,160.83 MB/s)
read_bytes: 0 (0.00 MB/s)
write_bytes: 200941568 (648,017,002.50 MB/s)
cancelled_write_bytes: 197926912 (638,295,030.27 MB/s)

Check file_search_array: time: 3.7282540798187 - PASS
rchar: 1846043100 (3,961,195,906.67 MB/s)
wchar: 153640688 (329,678,578.15 MB/s)
syscr: 205735 (441,461.33 MB/s)
syscw: 10320 (22,144.41 MB/s)
read_bytes: 0 (0.00 MB/s)
write_bytes: 153853952 (330,136,195.03 MB/s)
cancelled_write_bytes: 153202688 (328,738,728.04 MB/s)

Check file_select_array: time: 2.9537951946259 - PASS
rchar: 2497627602 (6,764,524,789.11 MB/s)
wchar: 166315040 (450,444,337.65 MB/s)
syscr: 150678 (408,093.29 MB/s)
syscw: 10488 (28,405.49 MB/s)
read_bytes: 0 (0.00 MB/s)
write_bytes: 166531072 (451,029,434.41 MB/s)
cancelled_write_bytes: 164159488 (444,606,283.60 MB/s)

Check file_search_line: time: 7.2284481525421 - PASS
rchar: 15166284068 (16,785,106,565.55 MB/s)
wchar: 197594237 (218,685,098.47 MB/s)
syscr: 1544095 (1,708,908.99 MB/s)
syscw: 11436 (12,656.66 MB/s)
read_bytes: 0 (0.00 MB/s)
write_bytes: 197804032 (218,917,286.62 MB/s)
cancelled_write_bytes: 196804608 (217,811,185.86 MB/s)

Check file_select_line: time: 2.2228870391846 - PASS
rchar: 827814895 (2,979,242,329.12 MB/s)
wchar: 195400780 (703,232,423.62 MB/s)
syscr: 91489 (329,261.90 MB/s)
syscw: 11764 (42,337.73 MB/s)
read_bytes: 0 (0.00 MB/s)
write_bytes: 195616768 (704,009,747.87 MB/s)
cancelled_write_bytes: 191799296 (690,270,958.87 MB/s)

Check file_pop_line - ERROR
rchar: 588882265 (319,688,924.84 MB/s)
wchar: 339546583 (184,331,042.90 MB/s)
syscr: 69950 (37,974.04 MB/s)
syscw: 17017 (9,238.09 MB/s)
read_bytes: 0 (0.00 MB/s)
write_bytes: 339828736 (184,484,216.45 MB/s)
cancelled_write_bytes: 340869120 (185,049,013.97 MB/s)

Check file_callback_line: time: 2.0378620624542 - PASS
rchar: 218743187 (858,716,361.74 MB/s)
wchar: 195721830 (768,341,817.07 MB/s)
syscr: 22283 (87,475.99 MB/s)
syscw: 11282 (44,289.55 MB/s)
read_bytes: 0 (0.00 MB/s)
write_bytes: 195928064 (769,151,426.33 MB/s)
cancelled_write_bytes: 196296704 (770,598,590.03 MB/s)
root@api:/home/commeta/project/kernel/fast_io# 

```


##### Статистика ядра Linux Kernel

Источник данных: /proc/pid/io — файл, который содержит информацию о вводе-выводе процесса. Он используется для мониторинга использования дискового ввода-вывода процессом.

- time - время выполнения теста, в секундах.

- rchar (read chars) — количество прочитанных символов процессом. Этот параметр показывает, сколько байт было прочитано процессом с момента запуска теста.

- wchar (written chars) — количество записанных символов процессом. Этот параметр показывает, сколько байт было записано процессом с момента запуска теста.

- syscr (system calls read) — количество системных вызовов чтения, сделанных процессом. Этот параметр показывает, сколько раз процесс обращался к операционной системе с запросом на чтение данных.

- syscw (system calls write) — количество системных вызовов записи, сделанных процессом. Этот параметр показывает, сколько раз процесс обращался к операционной системе с запросом на запись данных.

- read_bytes — общее количество байт, прочитанных процессом с диска. Этот параметр показывает, сколько байт было прочитано процессом с диска с момента запуска теста.

- write_bytes — общее количество байт, записанных процессом на диск. Этот параметр показывает, сколько байт было записано процессом на диск с момента запуска теста.

- cancelled_write_bytes — количество байт, которые были отменены процессом при записи на диск. Этот параметр показывает, сколько байт было отменено процессом при попытке записи на диск.


