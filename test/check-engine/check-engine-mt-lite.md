# üöÄ –ú–Ω–æ–≥–æ-–ø—Ä–æ—Ü–µ—Å—Å–Ω—ã–π —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç

## `check-engine-mt-lite.php` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ thread/process-safety

**check-engine-mt-lite.php** ‚Äî —ç—Ç–æ **–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–Ω—ã–π —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç** –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `fast_io`.  
–û–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ PHP-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ–∞–π–ª–∞–º–∏ –ø–æ–¥ —Ä–µ–∞–ª—å–Ω–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–µ–π.

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç:**
- `file_insert_line()` (mode = 2)
- `file_update_line()` (mode = 0)
- `file_select_line()` (mode = 1)
- `file_select_array()`
- `file_update_array()` (mode = 0)

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ** –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.  
–¢–µ—Å—Ç –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤—ã—è–≤–ª—è–µ—Ç –ª—é–±—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ (`flock`), —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ñ–∞–π–ª–∞ –∏ race conditions.

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 8.1+ —Å –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –æ–ø—Ü–∏–µ–π `--enable-pcntl`
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `fast_io` —Å–æ–±—Ä–∞–Ω–æ –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
- –ü—Ä–∞–≤–æ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–∞

---

## –ó–∞–ø—É—Å–∫

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ (12 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ √ó 120 –∏—Ç–µ—Ä–∞—Ü–∏–π)
php check-engine-mt-lite.php

# –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
php check-engine-mt-lite.php 16 200     # 16 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ √ó 200 –∏—Ç–µ—Ä–∞—Ü–∏–π
php check-engine-mt-lite.php 32 150     # –æ—á–µ–Ω—å –∂—ë—Å—Ç–∫–∏–π —Ä–µ–∂–∏–º
```

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:**
- 1-–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (`workers`, –º–∏–Ω–∏–º—É–º 2)
- 2-–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å (`iterations`, –º–∏–Ω–∏–º—É–º 10)

---

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞

1. –°–æ–∑–¥–∞—ë—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª `fast_io_mt_stress.dat`
2. –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å:
   - –†–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ —Å–æ —Å–≤–æ–∏–º–∏** `offset`-–∞–º–∏ (–≥–∞—Ä–∞–Ω—Ç–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è race condition)
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (35 % insert, 25 % update, 18 % select –∏ —Ç.–¥.)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `mt_srand()` —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Å–∏–¥–æ–º
3. –ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `file_analize()`:
   - `flow_interruption` **–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å = 0**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ > 100
4. –§–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ

---

## –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞

```bash
=== fast_io –ú–ù–û–ì–û–ü–†–û–¶–ï–°–°–ù–´–ô –°–¢–†–ï–°–°-–¢–ï–°–¢ v2.1 ===
–ü—Ä–æ—Ü–µ—Å—Å–æ–≤          : 12
–ò—Ç–µ—Ä–∞—Ü–∏–π –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å: 120

===========================================================================
–¢–ï–°–¢ –ó–ê–í–ï–†–®–Å–ù
–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è      : 4.872 —Å–µ–∫
–ù–µ—É–¥–∞—á–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤   : 0 / 12
–°—Ç—Ä–æ–∫ –≤ —Ñ–∞–π–ª–µ         : 1248
–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –ø–æ—Ç–æ–∫–∞     : 0
–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ : 2048 –±–∞–π—Ç

‚úÖ check-engine-mt-lite.php ‚Äî –£–°–ü–ï–®–ù–û –ü–†–û–ô–î–ï–ù
–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é thread/process-safe –ø–æ–¥ –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π

–ì–æ—Ç–æ–≤–æ. –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —Ä–∞–∑ ‚Äî —Ñ–∞–π–ª –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
```

---

## –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

–í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥:

```php
define('DEBUG', true);   // –±—ã–ª–æ false
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç **–ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ä–µ–ª–∏–∑–æ–º** —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `32 300`
- –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ—á—Ç–∏ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –≤ `fast_io.c` (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–ª–∏ —Ä–∞–±–æ—Ç–∞ —Å –±—É—Ñ–µ—Ä–∞–º–∏)
- –¢–µ—Å—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—Å–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (`file_insert_line.md`, `file_update_array.md`, `file_analize.md` –∏ —Ç.–¥.)

---

**–§–∞–π–ª:** `test/check-engine-mt-lite.php`

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ ‚Äî —ç—Ç–æ –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `fast_io` –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É.
```

