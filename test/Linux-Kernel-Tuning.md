# üöÄ Linux Kernel Tuning –¥–ª—è fast_io ‚Äî –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

**fast_io** ‚Äî —ç—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ C-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PHP 8.1+ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ aligned –±–ª–æ–∫–∞–º–∏** (512‚Äì65536 –±–∞–π—Ç), `flock(LOCK_EX)`, random offset-–¥–æ—Å—Ç—É–ø–æ–º, –º–∞—Å—Å–æ–≤—ã–º–∏ update/search/defrag/replicate –∏ concurrency —á–µ—Ä–µ–∑ **Fibers** / **pcntl_fork**.

–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç—é–Ω–∏–Ω–≥ —è–¥—Ä–∞ –¥–∞—ë—Ç **+2‚Äì5√ó throughput** –∏ **‚àí80 % tail latency** –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ 10k+ –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫ –Ω–∞ —Ñ–∞–π–ª—ã 1‚Äì100 –ì–ë.

---

## 1. –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)

| –ü–∞—Ä–∞–º–µ—Ç—Ä                        | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è fast_io          | –ü–æ—á–µ–º—É |
|--------------------------------|-----------------------|-------------------------------|--------|
| **–Ø–¥—Ä–æ**                       | ‚Äî                     | **6.1+** (–∏–ª–∏ 5.15 LTS)       | –õ—É—á—à–∏–π page cache + BFQ/mq-deadline |
| **–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**           | ext4                  | **ext4** —Å `noatime,nodiratime,data=writeback,commit=1` | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overhead –∂—É—Ä–Ω–∞–ª–∞ |
| **–î–∏—Å–∫**                       | HDD/SSD               | **NVMe SSD**                  | 4K aligned –∑–∞–ø–∏—Å–∏ = –º–∞–∫—Å–∏–º—É–º IOPS |
| **PHP**                        | ‚Äî                     | `fast_io.buffer_size=131072`  | –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç—é–Ω–∏–Ω–≥–æ–º dirty pages |

**–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–¥–∏–Ω —Ä–∞–∑):**
```bash
mount -o remount,noatime,nodiratime,commit=1,data=writeback /var/db/fast_io
```

---

## 2. –í—Å–µ kernel-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–ª–∏—è—é—Ç –Ω–∞ fast_io

### 2.1 VM / Page Cache (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ!)

```bash
# /etc/sysctl.d/99-fastio.conf
vm.dirty_ratio                  = 5          # –ø—Ä–æ—Ü–µ—Å—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ 5% RAM
vm.dirty_background_ratio       = 2          # pdflush –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞–Ω–æ
vm.dirty_bytes                  = 67108864   # 64 MiB (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ratio ‚Äî —Ç–æ—á–Ω–µ–µ)
vm.dirty_background_bytes       = 33554432   # 32 MiB
vm.dirty_expire_centisecs       = 500        # 5 —Å–µ–∫ (–±—ã—Å—Ç—Ä–µ–µ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –≥—Ä—è–∑–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
vm.dirty_writeback_centisecs    = 100        # 1 —Å–µ–∫ (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π writeback)
vm.dirtytime_expire_seconds     = 60
vm.vfs_cache_pressure           = 200        # –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç page cache –Ω–∞–¥ dentry/inode (—É –Ω–∞—Å –º–∞–ª–æ —Ñ–∞–π–ª–æ–≤)
vm.swappiness                   = 10         # –ø–æ—á—Ç–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å swap
vm.min_free_kbytes              = 1048576    # 1 GiB —Å–≤–æ–±–æ–¥–Ω–æ–π –ø–∞–º—è—Ç–∏ (–¥–ª—è –±–æ–ª—å—à–∏—Ö DB)
vm.overcommit_memory            = 1          # –≤—Å–µ–≥–¥–∞ overcommit (–º–Ω–æ–≥–æ fibers/forks)
```

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
| –¢–∏–ø –ë–î                     | dirty_ratio | dirty_background_ratio | vfs_cache_pressure |
|---------------------------|-------------|------------------------|--------------------|
| –ú–∞–ª–µ–Ω—å–∫–∞—è (< 2 –ì–ë)        | 10          | 5                      | 100                |
| –°—Ä–µ–¥–Ω—è—è write-heavy       | **5**       | **2**                  | **200**            |
| –û–≥—Ä–æ–º–Ω–∞—è (10‚Äì100 –ì–ë)      | 3           | 1                      | 300                |
| Read-only / –º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞  | 20          | 10                     | **50**             |

### 2.2 Readahead (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è `file_search_*`, `file_select_array`, `file_get_keys`)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä:**  
`read_ahead_kb` –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —è–¥—Ä–æ –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –≤ page cache —Å–ª–µ–¥—É—é—â–∏–µ N –∫–∏–ª–æ–±–∞–π—Ç –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —á—Ç–µ–Ω–∏—è. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–±—ã—á–Ω–æ 128‚Äì512 KiB.

**–ö–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ fast_io:**  
fast_io –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `file_search_array`, `file_search_line`, `file_get_keys` –∏ `file_select_array` ‚Äî –≤—Å–µ –æ–Ω–∏ –¥–µ–ª–∞—é—Ç **—Å–ª—É—á–∞–π–Ω—ã–µ** –∏–ª–∏ **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ** —á—Ç–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –±–ª–æ–∫–æ–≤. –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π readahead –ø–æ–∑–≤–æ–ª—è–µ—Ç —è–¥—Ä—É **–ø—Ä–µ–¥—É–≥–∞–¥—ã–≤–∞—Ç—å** —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫ –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –µ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç–µ–∫—É—â–µ–≥–æ.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°–Ω–∏–∂–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–ª—å–Ω—ã—Ö I/O-–æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ 30‚Äì70 % –ø—Ä–∏ –ø–æ–∏—Å–∫–µ.
- –£—Å–∫–æ—Ä—è–µ—Ç `file_search_array` —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ PCRE2 –≤ 2‚Äì4 —Ä–∞–∑–∞.
- –û—Å–æ–±–µ–Ω–Ω–æ –∑–∞–º–µ—Ç–Ω–æ –Ω–∞ NVMe (–≥–¥–µ latency < 50 –º–∫—Å).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```bash
# –î–ª—è NVMe
echo 8192 > /sys/block/nvme0n1/queue/read_ahead_kb
# –î–ª—è SATA SSD
echo 4096 > /sys/block/sda/queue/read_ahead_kb
```
(–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —á–µ—Ä–µ–∑ udev-–ø—Ä–∞–≤–∏–ª–æ).

### 2.3 I/O Scheduler

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**  
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ I/O-–∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –¥–∏—Å–∫.

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ fast_io:**
- `mq-deadline` (NVMe/SSD) ‚Äî —Å–∞–º—ã–π –Ω–∏–∑–∫–∏–π latency –¥–ª—è —Å–ª—É—á–∞–π–Ω—ã—Ö 4K-–∑–∞–ø–∏—Å–µ–π –∏ —á—Ç–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `file_update_line`, `file_insert_line`, `file_defrag_data`.
- `bfq` (HDD) ‚Äî —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö fibers/processes, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç ¬´–≥–æ–ª–æ–¥–∞–Ω–∏–µ¬ª –º–µ–ª–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°–Ω–∏–∂–∞–µ—Ç p99 latency —Å 50 –º—Å –¥–æ < 5 –º—Å –Ω–∞ SSD.
- –£–ª—É—á—à–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ 20+ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö fibers.

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
# SSD / NVMe
echo mq-deadline > /sys/block/nvme0n1/queue/scheduler
# HDD
echo bfq > /sys/block/sda/queue/scheduler
```

### 2.4 –õ–∏–º–∏—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**  
`fs.file-max`, `fs.nr_open`, `limits.conf` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ fast_io:**
fast_io –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `flock(LOCK_EX)` –Ω–∞ –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª + –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤–æ –≤—Ä–µ–º—è `replicate_file`, `defrag_data`, `file_callback_line`. –ü—Ä–∏ 24+ fibers –∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ç–∞–±–ª–∏—Ü –ª–µ–≥–∫–æ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç 1024.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ò—Å–∫–ª—é—á–∞–µ—Ç –æ—à–∏–±–∫—É ¬´Too many open files¬ª.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å `check-engine-fiber.php 64 1000` –±–µ–∑ –∫—Ä–∞—Ö–∞.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
# /etc/security/limits.conf
* soft nofile 1048576
* hard nofile 2097152
* soft nproc  65535
* hard nproc  131072
```
```bash
# /etc/sysctl.d/99-fastio.conf
fs.file-max                     = 2097152
fs.nr_open                      = 2097152
```

### 2.5 Transparent Huge Pages (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ç–∫–ª—é—á–∏—Ç—å)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**  
THP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç 4K-—Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ 2 –ú–ë huge pages.

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ fast_io:**
fast_io —Ä–∞–±–æ—Ç–∞–µ—Ç —Å **—Å—Ç—Ä–æ–≥–æ –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–º–∏** –±–ª–æ–∫–∞–º–∏ (ALIGN=512/4096/65536). Huge pages –ª–æ–º–∞—é—Ç —Ç–æ—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ page cache –∏ –≤—ã–∑—ã–≤–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ `file_update_array`, `file_select_array`.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:**
- –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ 10‚Äì100 –º—Å.
- –£–ª—É—á—à–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏—è `vm.dirty_*`.

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
echo never > /sys/kernel/mm/transparent_hugepage/enabled
echo never > /sys/kernel/mm/transparent_hugepage/defrag
```

### 2.6 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–ø–æ–ª–µ–∑–Ω–æ)

```bash
vm.zone_reclaim_mode            = 0          # –Ω–µ –ø—ã—Ç–∞—Ç—å—Å—è –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –ø–∞–º—è—Ç—å –≤–Ω—É—Ç—Ä–∏ NUMA-—É–∑–ª–∞ (–∑–∞–º–µ–¥–ª—è–µ—Ç –ø—Ä–∏ –±–æ–ª—å—à–æ–º RAM)
kernel.sched_autogroup_enabled  = 0          # –æ—Ç–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –∑–∞–¥–∞—á ‚Äî –≤–∞–∂–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ fibers –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
fs.aio-max-nr                   = 1048576    # —Ä–µ–∑–µ—Ä–≤ –Ω–∞ –±—É–¥—É—â–µ–µ (—Ö–æ—Ç—è fast_io –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç aio –Ω–∞–ø—Ä—è–º—É—é)
```

---

## 3. –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ (—Å–∫–æ–ø–∏—Ä—É–π –∏ –ø—Ä–∏–º–µ–Ω–∏)

### –ü—Ä–æ—Ñ–∏–ª—å A ‚Äî ¬´–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å write-heavy¬ª (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**  
- –ú–Ω–æ–≥–æ `file_insert_line`, `file_update_line`, `file_update_array`, `file_defrag_data`, `file_replace_line`.  
- –ë–∞–∑–∞ —Ä–∞—Å—Ç—ë—Ç –±—ã—Å—Ç—Ä–µ–µ 1 –ì–ë/–¥–µ–Ω—å.  
- –û–∂–∏–¥–∞–µ–º–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ > 5k write-op/s.

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** +300‚Äì500 % throughput –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –¥–µ—Ñ–æ–ª—Ç–æ–º, Dirty –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ < 50 MiB.

```bash
cat > /etc/sysctl.d/99-fastio.conf <<EOF
vm.dirty_ratio=5
vm.dirty_background_ratio=2
vm.dirty_bytes=67108864
vm.dirty_background_bytes=33554432
vm.dirty_expire_centisecs=500
vm.dirty_writeback_centisecs=100
vm.vfs_cache_pressure=200
vm.swappiness=10
vm.min_free_kbytes=1048576
fs.file-max=2097152
EOF
sysctl -p /etc/sysctl.d/99-fastio.conf
```

### –ü—Ä–æ—Ñ–∏–ª—å B ‚Äî ¬´–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å read-heavy¬ª

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**  
- –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ ‚Äî `file_search_array`, `file_get_keys`, `file_select_array`, `file_analize`.  
- –ë–∞–∑–∞ –ø–æ—á—Ç–∏ —Å—Ç–∞—Ç–∏—á–Ω–∞ (read-only –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –ø–æ–∏—Å–∫–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã).

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** page cache –æ—Å—Ç–∞—ë—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º, readahead —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ, latency –ø–æ–∏—Å–∫–∞ –ø–∞–¥–∞–µ—Ç –≤ 3‚Äì5 —Ä–∞–∑.

```bash
vm.vfs_cache_pressure=50
vm.dirty_ratio=20
vm.dirty_background_ratio=10
```

(–¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `99-fastio.conf` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `sysctl -p`).

---

## 4. –°–∫—Ä–∏–ø—Ç one-click —Ç—é–Ω–∏–Ω–≥–∞

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**  
–û–¥–Ω–∏–º –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ + readahead –¥–ª—è –≤—Å–µ—Ö NVMe + –æ—Ç–∫–ª—é—á–∞–µ—Ç THP + —Å—Ç–∞–≤–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π scheduler.

```bash
#!/bin/bash
# fastio-tune.sh
cat > /etc/sysctl.d/99-fastio.conf <<'EOF'
vm.dirty_ratio=5
vm.dirty_background_ratio=2
vm.dirty_expire_centisecs=500
vm.dirty_writeback_centisecs=100
vm.vfs_cache_pressure=200
vm.swappiness=10
vm.min_free_kbytes=1048576
fs.file-max=2097152
kernel.sched_autogroup_enabled=0
EOF
sysctl -p /etc/sysctl.d/99-fastio.conf

# Readahead –¥–ª—è –≤—Å–µ—Ö NVMe
for dev in /sys/block/nvme*; do
    echo 8192 > $dev/queue/read_ahead_kb
done

echo never > /sys/kernel/mm/transparent_hugepage/enabled
echo mq-deadline > /sys/block/nvme0n1/queue/scheduler 2>/dev/null || true

echo "‚úÖ fast_io kernel tuning applied!"
```

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
```bash
chmod +x fastio-tune.sh && ./fastio-tune.sh
```
–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—á—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ —Ç—é–Ω–∏–Ω–≥–∞)

```bash
# –î–æ/–ø–æ—Å–ª–µ –Ω–∞–≥—Ä—É–∑–∫–∏
cat /proc/vmstat | grep -E 'pgpgout|pgpgin|pgdirty|pgwriteback'
cat /proc/meminfo | grep -E 'Dirty|Writeback|Cached'
iotop -o
cat /proc/$(pgrep php)/io
```

**–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫:**

- **pgpgout / pgpgin** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö/–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —è–¥—Ä–æ–º.  
  *–ò–¥–µ–∞–ª:* –≤—ã—Å–æ–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–∑ ¬´–ø–ª–∞—Ç–æ¬ª (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø–æ—Ç–æ–∫, –∞ –Ω–µ —Ä–µ–∑–∫–∏–µ –≤—Å–ø–ª–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫).

- **Dirty / Writeback** –≤ `/proc/meminfo` ‚Äî —Å–∫–æ–ª—å–∫–æ –≥—Ä—è–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü —Å–µ–π—á–∞—Å –≤ RAM.  
  *–¶–µ–ª—å:* **Dirty < 100 MiB –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞** ‚Äî —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ writeback —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –∏ –Ω–µ –¥–∞—ë—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è –±–æ–ª—å—à–∏–º –æ—á–µ—Ä–µ–¥—è–º.

- **iotop -o** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –ø–∏—à—É—Ç/—á–∏—Ç–∞—é—Ç –¥–∏—Å–∫.  
  *–ò–¥–µ–∞–ª:* php-fpm/worker –ø—Ä–æ—Ü–µ—Å—Å—ã –≤–∏–¥–Ω—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ, –Ω–æ –±–µ–∑ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö ¬´100 %¬ª –Ω–∞ –æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ.

- **/proc/$(pgrep php)/io** ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ PHP-–ø—Ä–æ—Ü–µ—Å—Å–∞ (rchar, wchar, syscr, syscw).  
  *–°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –¥–æ –∏ –ø–æ—Å–ª–µ —Ç—é–Ω–∏–Ω–≥–∞* ‚Äî wchar –¥–æ–ª–∂–µ–Ω –≤—ã—Ä–∞—Å—Ç–∏, –∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ syscw —É–ø–∞—Å—Ç—å.

**–¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ—Å–ª–µ —Ç—é–Ω–∏–Ω–≥–∞:**
- `pgpgout` / `pgpgin` ‚Äî –≤—ã—Å–æ–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–∑ –¥–ª–∏–Ω–Ω—ã—Ö –ø–∞—É–∑
- `Dirty` < 100 MiB –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞
- `file_analize` + `file_defrag_data` –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ 2‚Äì3√ó –±—ã—Å—Ç—Ä–µ–µ

---

## 6. –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º production

- [ ] `fast_io.buffer_size=131072` –≤ `php.ini`  
  *(—Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–∞–∑–º–µ—Ä–æ–º –≥—Ä—è–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∞)*

- [ ] `ulimit -n 1048576` –¥–ª—è php-fpm / worker  
  *(–∏–Ω–∞—á–µ fibers —É–ø–∞–¥—É—Ç —Å ¬´Too many open files¬ª –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ç–∞–±–ª–∏—Ü)*

- [ ] –¢—é–Ω–∏–Ω–≥ —è–¥—Ä–∞ –ø—Ä–∏–º–µ–Ω—ë–Ω –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ `/etc/sysctl.d/`  
  *(–ø—Ä–æ–≤–µ—Ä—å—Ç–µ `sysctl -a | grep dirty`)*

- [ ] –§–∞–π–ª—ã –ë–î –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º NVMe —Å `noatime`  
  *(–∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∫–∞–∂–¥–æ–º —á—Ç–µ–Ω–∏–∏/–∑–∞–ø–∏—Å–∏)*

- [ ] `vm.dirty_*` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ–¥ –æ–±—ä—ë–º RAM (–Ω–µ –±–æ–ª—å—à–µ 5‚Äì10% –Ω–∞ dirty)  
  *(–∏–Ω–∞—á–µ –ø—Ä–∏ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å OOM –∏–ª–∏ stall)*

- [ ] –¢–µ—Å—Ç `check-engine-fiber.php 24 500` –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫  
  *(—ç—Ç–æ —Å–∞–º—ã–π –∂—ë—Å—Ç–∫–∏–π —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç concurrency –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö)*

---

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Ubuntu 24.04 LTS (–ª—É—á—à–µ, —á–µ–º –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π)

### –ü–æ—á–µ–º—É –≤—Å—ë –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Ubuntu 24.04 (–ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –Ω–∞ —Ñ–µ–≤—Ä–∞–ª—å 2026):

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞               | Ubuntu 24.04 (—è–¥—Ä–æ 6.8 / 6.11 HWE) | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-------------------------------------|------------------------------------|---------------|----------|
| –Ø–¥—Ä–æ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 6.1+)            | 6.8 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) / 6.11 HWE      | ‚úÖ –û—Ç–ª–∏—á–Ω–æ    | –î–∞–∂–µ –Ω–æ–≤–µ–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–≥–æ |
| `/etc/sysctl.d/99-fastio.conf`      | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é           | ‚úÖ            | –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| `/etc/security/limits.conf`         | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è                     | ‚úÖ            | –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ |
| `/sys/block/.../read_ahead_kb`      | –†–∞–±–æ—Ç–∞–µ—Ç                           | ‚úÖ            | –î–ª—è nvme0n1, sda –∏ —Ç.–¥. |
| `/sys/block/.../scheduler`          | mq-deadline –∏ bfq –¥–æ—Å—Ç—É–ø–Ω—ã         | ‚úÖ            | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é mq-deadline –Ω–∞ NVMe |
| `echo never > /sys/kernel/mm/transparent_hugepage/...` | –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ |
| –í—Å–µ vm.* –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (dirty_*, vfs_cache_pressure –∏ —Ç.–¥.) | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å 5.15 | ‚úÖ | –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |

### –ù–µ–±–æ–ª—å—à–∏–µ Ubuntu-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–¥–æ–±–∞–≤—å –∏—Ö, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –º–∞–∫—Å–∏–º—É–º)

1. **–°–¥–µ–ª–∞–π readahead –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º** (—Å–∫—Ä–∏–ø—Ç one-click –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ–∫—É—â–∏–π –∑–∞–ø—É—Å–∫):
   ```bash
   cat > /etc/udev/rules.d/60-fastio-readahead.rules <<EOF
   ACTION=="add|change", KERNEL=="nvme[0-9]n[0-9]", ATTR{queue/read_ahead_kb}="8192"
   ACTION=="add|change", KERNEL=="sd[a-z]", ATTR{queue/read_ahead_kb}="4096"
   EOF
   udevadm control --reload-rules && udevadm trigger
   ```

2. **–î–ª—è php-fpm (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ!)** ‚Äî –ª–∏–º–∏—Ç—ã nofile –ª—É—á—à–µ –∑–∞–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ systemd, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ limits.conf:
   ```bash
   mkdir -p /etc/systemd/system/php8.3-fpm.service.d
   cat > /etc/systemd/system/php8.3-fpm.service.d/limits.conf <<EOF
   [Service]
   LimitNOFILE=1048576
   LimitNPROC=131072
   EOF
   systemctl daemon-reload
   systemctl restart php8.3-fpm
   ```
---

### –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥

| –í–µ—Ä—Å–∏—è —è–¥—Ä–∞          | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (fast_io.so) | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------------------|---------------------------------------|----------------------|--------------|
| **2.6.0 ‚Äì 2.6.19**   | –†–∞–±–æ—Ç–∞–µ—Ç                              | –ß–∞—Å—Ç–∏—á–Ω–æ (–±–µ–∑ IO-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏) | –¢–æ–ª—å–∫–æ legacy |
| **2.6.20 ‚Äì 4.4**     | –ü–æ–ª–Ω–∞—è                                | –ü–æ–ª–Ω–∞—è               | –ü—Ä–∏–µ–º–ª–µ–º–æ |
| **4.4 ‚Äì 5.15**       | –ü–æ–ª–Ω–∞—è + —Ö–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å   | –ü–æ–ª–Ω–∞—è               | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| **5.15 ‚Äì 6.1**       | **–û—Ç–ª–∏—á–Ω–∞—è**                          | **–û—Ç–ª–∏—á–Ω–∞—è**         | **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ** |
| **6.1 ‚Äì 6.8+** (Ubuntu 24.04) | **–ò–¥–µ–∞–ª—å–Ω–∞—è**                   | **–ò–¥–µ–∞–ª—å–Ω–∞—è**        | **–õ—É—á—à–∏–π –≤—ã–±–æ—Ä** |

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è —è–¥—Ä–∞:** **2.6.20**  
**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –≤–µ—Ä—Å–∏—è:** **5.15+** (–∏–ª–∏ 6.1+ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

---

### –†–∞–∑–±–æ—Ä –ø–æ –∫–ª—é—á–µ–≤—ã–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º

#### 1. –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –≤ `fast_io.c`

| –í—ã–∑–æ–≤ / –§—É–Ω–∫—Ü–∏—è                  | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —è–¥—Ä–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------------------------------|--------------------------|-----------|
| `flock(LOCK_EX)`                 | **2.0** (1996)          | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ 90 % —Ñ—É–Ω–∫—Ü–∏–π. –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º –≤—Å–µ–≥–¥–∞ |
| `fopen / fseek / ftell / fread / fwrite` | **2.0**               | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ libc ‚Äî —Ä–∞–±–æ—Ç–∞—é—Ç –≤–µ–∑–¥–µ |
| `/proc/<pid>/io`                 | **2.6.20** (–º–∞—Ä—Ç 2007)  | **–ö—Ä–∏—Ç–∏—á–Ω–æ** ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (`get_io_stats()`) |
| `pcre2_compile / pcre2_match`    | –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —è–¥—Ä–∞      | –í–Ω–µ—à–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ |
| `emalloc / erealloc`             | –ù–µ –∑–∞–≤–∏—Å–∏—Ç              | PHP memory manager |

**–í—ã–≤–æ–¥:** –°–∞–º–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ **–Ω–µ –∏–º–µ–µ—Ç –∂—ë—Å—Ç–∫–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π** –∫ —è–¥—Ä—É. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–∞–∂–µ –Ω–∞ –æ—á–µ–Ω—å —Å—Ç–∞—Ä—ã—Ö —è–¥—Ä–∞—Ö.

#### 2. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —è–¥—Ä–∞—Ö —Å—Ç–∞—Ä—à–µ 2.6.20

- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ **–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç**.
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`file_insert_line`, `file_search_array`, `file_defrag_data` –∏ —Ç.–¥.) —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
- **–¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã** (`check-engine-mt.php`, `check-engine-fiber.php`, `check-engine.php`) –ø–æ–∫–∞–∂—É—Ç:
  - `get_io_stats()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]`
  - –ù–µ—Ç –≤—ã–≤–æ–¥–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ `/proc/PID/io`
  - –ù—É–∂–µ–Ω –∞–Ω–∞–ª–∏–∑ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö (PASS/FAIL, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).

#### 3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –≤–µ—Ä—Å–∏–∏ —è–¥—Ä–∞ (2026 –≥–æ–¥)

| –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è               | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —è–¥—Ä–æ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —è–¥—Ä–æ | –ü–æ—á–µ–º—É |
|--------------------------------------|------------------|--------------------|--------|
| –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ / —Ç–µ—Å—Ç—ã                   | 2.6.20           | 6.1+               | –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ I/O |
| Production write-heavy (–º–Ω–æ–≥–æ update/defrag) | 4.4          | **5.15 ‚Äì 6.8**     | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π writeback + mq-deadline |
| Production read-heavy (–ø–æ–∏—Å–∫)        | 4.4              | **5.15 ‚Äì 6.8**     | –õ—É—á—à–∏–π page cache + readahead |
| Ubuntu 24.04 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)          | ‚Äî                | **6.8** (–∏–ª–∏ 6.11 HWE) | –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–∞–ª—å–Ω–æ |

---




## –ê–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ fast_io —Å –≤–µ—Ä—Å–∏—è–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

(–Ω–∞ –æ—Å–Ω–æ–≤–µ `fast_io.c`, –≤—ã–≤–æ–¥–∞ `./compile.sh` –∏ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤, —Ñ–µ–≤—Ä–∞–ª—å 2026)

```
root@api:/home/commeta/project/kernel/fast_io# uname -a
Linux api.webdevops.ru 6.8.0-100-generic #100-Ubuntu SMP PREEMPT_DYNAMIC Tue Jan 13 16:40:06 UTC 2026 x86_64 x86_64 x86_64 GNU/Linux
root@api:/home/commeta/project/kernel/fast_io# ./compile.sh
Configuring for:
PHP Api Version:         20230831
Zend Module Api No:      20230831
Zend Extension Api No:   420230831
configure.ac:165: warning: The macro `AC_PROG_LIBTOOL' is obsolete.
configure.ac:165: You should run autoupdate.
build/libtool.m4:100: AC_PROG_LIBTOOL is expanded from...
configure.ac:165: the top level
find . -name \*.gcno -o -name \*.gcda | xargs rm -f
find . -name \*.lo -o -name \*.o -o -name \*.dep | xargs rm -f
find . -name \*.la -o -name \*.a | xargs rm -f
find . -name \*.so | xargs rm -f
find . -name .libs -a -type d|xargs rm -rf
rm -f libphp.la      modules/* libs/*
rm -f ext/opcache/jit/zend_jit_x86.c
rm -f ext/opcache/jit/zend_jit_arm64.c
rm -f ext/opcache/minilua
/bin/bash /home/commeta/project/kernel/fast_io/libtool --tag=CC --mode=compile cc -I. -I/home/commeta/project/kernel/fast_io -I/home/commeta/project/kernel/fast_io/include -I/home/commeta/project/kernel/fast_io/main -I/home/commeta/project/kernel/fast_io -I/usr/include/php/20230831 -I/usr/include/php/20230831/main -I/usr/include/php/20230831/TSRM -I/usr/include/php/20230831/Zend -I/usr/include/php/20230831/ext -I/usr/include/php/20230831/ext/date/lib  -DHAVE_CONFIG_H  -g -O2 -D_GNU_SOURCE    -DZEND_COMPILE_DL_EXT=1 -c /home/commeta/project/kernel/fast_io/fast_io.c -o fast_io.lo  -MMD -MF fast_io.dep -MT fast_io.lo
libtool: compile:  cc -I. -I/home/commeta/project/kernel/fast_io -I/home/commeta/project/kernel/fast_io/include -I/home/commeta/project/kernel/fast_io/main -I/home/commeta/project/kernel/fast_io -I/usr/include/php/20230831 -I/usr/include/php/20230831/main -I/usr/include/php/20230831/TSRM -I/usr/include/php/20230831/Zend -I/usr/include/php/20230831/ext -I/usr/include/php/20230831/ext/date/lib -DHAVE_CONFIG_H -g -O2 -D_GNU_SOURCE -DZEND_COMPILE_DL_EXT=1 -c /home/commeta/project/kernel/fast_io/fast_io.c -MMD -MF fast_io.dep -MT fast_io.lo  -fPIC -DPIC -o .libs/fast_io.o
/bin/bash /home/commeta/project/kernel/fast_io/libtool --tag=CC --mode=link cc -shared -I/home/commeta/project/kernel/fast_io/include -I/home/commeta/project/kernel/fast_io/main -I/home/commeta/project/kernel/fast_io -I/usr/include/php/20230831 -I/usr/include/php/20230831/main -I/usr/include/php/20230831/TSRM -I/usr/include/php/20230831/Zend -I/usr/include/php/20230831/ext -I/usr/include/php/20230831/ext/date/lib  -DHAVE_CONFIG_H  -g -O2 -D_GNU_SOURCE    -o fast_io.la -export-dynamic -avoid-version -prefer-pic -module -rpath /home/commeta/project/kernel/fast_io/modules  fast_io.lo 
libtool: link: cc -shared  -fPIC -DPIC  .libs/fast_io.o    -g -O2   -Wl,-soname -Wl,fast_io.so -o .libs/fast_io.so
libtool: link: ( cd ".libs" && rm -f "fast_io.la" && ln -s "../fast_io.la" "fast_io.la" )
/bin/bash /home/commeta/project/kernel/fast_io/libtool --tag=CC --mode=install cp ./fast_io.la /home/commeta/project/kernel/fast_io/modules
libtool: install: cp ./.libs/fast_io.so /home/commeta/project/kernel/fast_io/modules/fast_io.so
libtool: install: cp ./.libs/fast_io.lai /home/commeta/project/kernel/fast_io/modules/fast_io.la
libtool: finish: PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin:/sbin" ldconfig -n /home/commeta/project/kernel/fast_io/modules
----------------------------------------------------------------------
Libraries have been installed in:
   /home/commeta/project/kernel/fast_io/modules

If you ever happen to want to link against installed libraries
in a given directory, LIBDIR, you must either use libtool, and
specify the full pathname of the library, or use the '-LLIBDIR'
flag during linking and do at least one of the following:
   - add LIBDIR to the 'LD_LIBRARY_PATH' environment variable
     during execution
   - add LIBDIR to the 'LD_RUN_PATH' environment variable
     during linking
   - use the '-Wl,-rpath -Wl,LIBDIR' linker flag
   - have your system administrator add LIBDIR to '/etc/ld.so.conf'

See any operating system documentation about shared libraries for
more information, such as the ld(1) and ld.so(8) manual pages.
----------------------------------------------------------------------

Build complete.
Don't forget to run 'make test'.
```

**–¢–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥: —Ç–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞** (Ubuntu 24.04 + —è–¥—Ä–æ 6.8.0-100-generic + PHP 8.3 API 20230831) ‚Äî **–∏–¥–µ–∞–ª—å–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞**. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ, –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ.

### 1. PHP / Zend API

| PHP –≤–µ—Ä—Å–∏—è       | Zend Module API | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------------|-----------------|---------------|-------------|
| **PHP 7.4**      | 20190902        | ‚ùå –ù–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è | –ù–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–∞–∫—Ä–æ—Å–æ–≤ arginfo |
| **PHP 8.0**      | 20200930        | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ     | –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –±–µ–∑ Fiber-—Ç–µ—Å—Ç–æ–≤ |
| **PHP 8.1**      | 20210902        | ‚úÖ –ü–æ–ª–Ω–∞—è       | –ú–∏–Ω–∏–º—É–º –¥–ª—è `check-engine-fiber.php` |
| **PHP 8.2**      | 20220829        | ‚úÖ –ü–æ–ª–Ω–∞—è       | –û—Ç–ª–∏—á–Ω–æ |
| **PHP 8.3** (–¢–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥) | **20230831**  | **‚úÖ –ò–¥–µ–∞–ª—å–Ω–∞—è** | –¢–µ–∫—É—â–∞—è —Å–±–æ—Ä–∫–∞ |
| **PHP 8.4+**     | 20240924+       | ‚úÖ –ü–æ–ª–Ω–∞—è       | –ë—É–¥—É—â–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |

**–í—ã–≤–æ–¥ –ø–æ PHP:**  
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è** ‚Äî PHP 8.1 (–∏–∑-–∑–∞ Fibers –≤ —Ç–µ—Å—Ç–∞—Ö)  
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è** ‚Äî PHP 8.3+  
- –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã `ZEND_BEGIN_ARG_WITH_RETURN_TYPE_INFO_EX` (–≤–≤–µ–¥–µ–Ω—ã –≤ PHP 7.0, —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å PHP 8.0).

### 2. PCRE2 (–ø—Ä—è–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `fast_io.c`)

| –í–µ—Ä—Å–∏—è PCRE2     | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------------|---------------|-------------|
| **10.00** (2015) | ‚úÖ –ë–∞–∑–æ–≤–∞—è    | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª—è `pcre2_compile` |
| **10.30** (2017) | ‚úÖ –•–æ—Ä–æ—à–∞—è    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ UTF |
| **10.40+** (2022+) | **‚úÖ –ò–¥–µ–∞–ª—å–Ω–∞—è** | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| **10.42+** (Ubuntu 24.04) | **‚úÖ –ò–¥–µ–∞–ª—å–Ω–∞—è** | –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥ |

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** `pcre2_compile`, `pcre2_match`, `pcre2_match_data_create_from_pattern`, `pcre2_get_ovector_pointer` –∏ —Ç.–¥. ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç —Å PCRE2 ‚â• 10.00.

**–ù–∞ Ubuntu 24.04:** `libpcre2-8-0` –∏ `libpcre2-dev` ‚Äî —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ, –ø—Ä–æ–±–ª–µ–º –Ω–µ—Ç.

### 3. glibc (C Library)

| glibc –≤–µ—Ä—Å–∏—è     | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------------|---------------|-------------|
| **2.15** (2012)  | ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è | –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ fopen/fread/flock |
| **2.28** (2018)  | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 64-bit I/O |
| **2.35** (Ubuntu 22.04) | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è | ‚Äî |
| **2.39** (Ubuntu 24.04) | **‚úÖ –ò–¥–µ–∞–ª—å–Ω–∞—è** | –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥ |

**–ö—Ä–∏—Ç–∏—á–Ω–æ:** `_FILE_OFFSET_BITS=64` (–≤–∫–ª—é—á–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—Ä–∫–∞—Ö).

### 4. Linux Kernel (syscalls)

| –Ø–¥—Ä–æ             | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------------|---------------|-------------|
| **2.6.20+** (2007) | ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è | `/proc/<pid>/io` –¥–ª—è —Ç–µ—Å—Ç–æ–≤ |
| **4.4 ‚Äì 5.4**    | ‚úÖ –•–æ—Ä–æ—à–∞—è    | ‚Äî |
| **5.15+**        | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è   | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π page cache |
| **6.1 ‚Äì 6.8** (–¢–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥) | **‚úÖ –ò–¥–µ–∞–ª—å–Ω–∞—è** | –õ—É—á—à–∏–π writeback + mq-deadline |

### 5. Build tools (autoconf / libtool)

- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –≤–∞—à–µ–º –≤—ã–≤–æ–¥–µ:** `AC_PROG_LIBTOOL is obsolete` ‚Äî —ç—Ç–æ –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö autotools (Ubuntu 24.04 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–µ–∂–∏–µ).
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –≤ –±—É–¥—É—â–µ–º –∑–∞–º–µ–Ω–∏—Ç—å `AC_PROG_LIBTOOL` –Ω–∞ `LT_INIT` –≤ `configure.ac`.

### –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç          | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –≤–µ—Ä—Å–∏—è | –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥ (Ubuntu 24.04) | –°—Ç–∞—Ç—É—Å |
|--------------------|--------------------|----------------------|----------------------------|--------|
| **PHP**            | 8.1                | 8.3+                 | 8.3 (20230831)             | –ò–¥–µ–∞–ª—å–Ω–æ |
| **PCRE2**          | 10.00              | 10.40+               | 10.42+                     | –ò–¥–µ–∞–ª—å–Ω–æ |
| **glibc**          | 2.15               | 2.35+                | 2.39                       | –ò–¥–µ–∞–ª—å–Ω–æ |
| **Linux Kernel**   | 2.6.20             | 6.1+                 | 6.8.0                      | –ò–¥–µ–∞–ª—å–Ω–æ |
| **Build tools**    | autotools 2015+    | 2022+                | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ                | –•–æ—Ä–æ—à–æ (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º) |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ fast_io 

—Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å **Zend Engine**

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Zend Engine

`fast_io.c` –ø–æ—Å—Ç—Ä–æ–µ–Ω **–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏** –ø–æ Zend Extension API (PHP 8.3, Zend API 20230831):

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª
- `PHP_MINIT_FUNCTION` ‚Üí `REGISTER_INI_ENTRIES()` (—Ç–æ–ª—å–∫–æ `fast_io.buffer_size`).
- `zend_module_entry` —Å `fast_io_functions[]`.
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã:
  ```c
  ZEND_BEGIN_ARG_WITH_RETURN_TYPE_INFO_EX(...)
  ```
  –≠—Ç–æ **PHP 7.0+ —Å—Ç–∏–ª—å** (type hints –≤ arginfo), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Zend Engine 8.x.

#### –û—Å–Ω–æ–≤–Ω—ã–µ Zend API, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –∫–æ–¥–µ
- `emalloc / erealloc / efree` ‚Äî Zend Memory Manager (–Ω–µ malloc!).
- `zval`, `array_init`, `add_assoc_string`, `add_assoc_long`, `add_next_index_zval` ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤.
- `zend_parse_parameters` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
- `call_user_function(EG(function_table), ...)` ‚Äî –≤ `file_callback_line` (–≤—ã–∑–æ–≤ PHP callback –∏–∑ C).
- `zend_is_callable`, `ZVAL_STRING`, `ZVAL_LONG`, `ZVAL_UNDEF`, `zval_dtor`, `zval_ptr_dtor`.
- `RETURN_FALSE`, `RETURN_LONG`, `RETURN_STR`, `RETURN_ARRAY` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã.

**–í–∞–∂–Ω–æ:** –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–∞–º—è—Ç—å—é –∏ zval –∏–¥—É—Ç —á–µ—Ä–µ–∑ **Zend Memory Manager**, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –†–∞–±–æ—Ç–∞—Ç—å —Å OPcache/JIT –±–µ–∑ —É—Ç–µ—á–µ–∫.
- –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ GC (garbage collection).
- –ë—ã—Ç—å thread-safe –≤ ZTS-—Å–±–æ—Ä–∫–∞—Ö (—Ö–æ—Ç—è fast_io –∏—Å–ø–æ–ª—å–∑—É–µ—Ç flock, –∞ –Ω–µ pthread).

